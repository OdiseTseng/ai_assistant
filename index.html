<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Odise's Personal Gemini Assistant">
    <title>Assistant</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Sidebar Menu -->
    <nav class="sidebar" id="sidebar">
        <div class="logo-area">
            Odise Assistant
            <button class="close-sidebar-btn" onclick="toggleSidebar()"
                style="margin-left:auto; background:none; border:none; color:white; font-size:1.2em; cursor:pointer; display:none;">×</button>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="navigate('dashboard')">
                🏠 儀表板
            </div>
            <div class="nav-item" onclick="openSettings()">
                ⚙️ 個人化設定
            </div>
            <div class="nav-item" onclick="openHelpModal()">
                ❓ 說明文件
            </div>
        </div>
        <div class="nav-footer" id="versionInfo">
            Version Info
        </div>
    </nav>
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Mobile Top Bar -->
        <div class="top-bar">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
            <span>Assistant</span>
        </div>

        <div class="dashboard-container">
            <!-- Global Info / Debug -->
            <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                <div id="statusText" style="margin-right:15px; align-self:center; font-size:0.9em; color:#94a3b8;">
                    狀態：等待操作...</div>
                <button id="debugInfoBtn" onclick="openDebugModal()"
                    style="padding:4px 10px; font-size:12px; display:none;">Debug Info</button>
            </div>

            <!-- Dashboard Tabs -->
            <div class="dashboard-tabs">
                <button class="dashboard-tab-btn active" onclick="switchDashboardTab('daily')">🏠 日常通勤</button>
                <button class="dashboard-tab-btn" onclick="switchDashboardTab('oldHome')">🏡 回老家</button>
                <button class="dashboard-tab-btn" onclick="switchDashboardTab('custom')">🗺️ 想去哪?</button>
            </div>

            <!-- TAB 1: DAILY -->
            <div id="tab-daily" class="dashboard-tab-content active">
                <div class="dashboard-grid">
                    <!-- Section 1: Itinerary & Query (Moved from Section 5) -->
                    <div class="card full-width" style="border-color: var(--accent-color);">
                        <h2>最佳轉乘方案 (未來2小時)</h2>

                        <!-- Controls (Moved from old Section 1) -->
                        <div
                            style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:15px;">

                            <button id="sendBtn" onclick="handleSend()" class="btn-primary" disabled>
                                📍 根據設定取得 GPS 並查詢
                            </button>
                        </div>

                        <div id="itinerary-result" class="result-box" style="padding:15px; min-height:100px;">
                            <span style="color:#666">等待查詢...</span>
                        </div>
                    </div>


                    <!-- Section Title: Favorite Stations -->
                    <div style="grid-column: 1 / -1; margin-top: 10px;">
                        <h2>喜好站點</h2>
                    </div>

                    <!-- Section 2: Train -->
                    <div class="card">
                        <h2>🚄 火車 <button class="btn-add" onclick="openStationModal('train')">+</button></h2>
                        <div id="train-list" class="station-list"></div>
                        <div id="train-result" class="result-box"></div>
                    </div>

                    <!-- Section 3: MRT (New) -->
                    <div class="card">
                        <h2>捷運 <button class="btn-add" onclick="openStationModal('mrt')">+</button></h2>
                        <div id="mrt-list" class="station-list"></div>
                        <div id="mrt-result" class="result-box"></div>
                    </div>

                    <!-- Section 3: Bus -->
                    <div class="card">
                        <h2>🚌 公車 <button class="btn-add" onclick="openStationModal('bus')">+</button></h2>
                        <div id="bus-list" class="station-list"></div>
                        <div id="bus-result" class="result-box"></div>
                    </div>

                    <!-- Section 4: Bike -->
                    <div class="card">
                        <h2>🚲 YouBike <button class="btn-add" onclick="openStationModal('bike')">+</button></h2>
                        <div id="bike-list" class="station-list"></div>
                        <div id="bike-result" class="result-box"></div>
                    </div>

                </div>
            </div>

            <!-- TAB 2: OLD HOME -->
            <div id="tab-oldHome" class="dashboard-tab-content">
                <div class="dashboard-grid">
                    <!-- Section 1: Itinerary & Query -->
                    <div class="card full-width" style="border-color: #fbbf24;">
                        <h2>回老家規劃</h2>

                        <!-- Controls -->
                        <div
                            style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:15px;">
                            <button id="sendBtnOldHome" onclick="handleSend('old_home')" class="btn-primary" disabled>
                                📍 回家囉
                            </button>
                        </div>

                        <div id="itinerary-result-oldHome" class="result-box" style="padding:15px; min-height:100px;">
                            <span style="color:#666">等待查詢...</span>
                        </div>
                    </div>

                    <!-- Section Title: Favorite Stations -->
                    <div style="grid-column: 1 / -1; margin-top: 10px;">
                        <h2>喜好站點</h2>
                    </div>

                    <!-- Section 2: Train -->
                    <div class="card">
                        <h2>🚄 火車 <button class="btn-add" onclick="openStationModal('train')">+</button></h2>
                        <div id="train-list-2" class="station-list"></div>
                        <div id="train-result-2" class="result-box"></div>
                    </div>

                    <!-- Section 3: MRT -->
                    <div class="card">
                        <h2>捷運 <button class="btn-add" onclick="openStationModal('mrt')">+</button></h2>
                        <div id="mrt-list-2" class="station-list"></div>
                        <div id="mrt-result-2" class="result-box"></div>
                    </div>

                    <!-- Section 3: Bus -->
                    <div class="card">
                        <h2>🚌 公車 <button class="btn-add" onclick="openStationModal('bus')">+</button></h2>
                        <div id="bus-list-2" class="station-list"></div>
                        <div id="bus-result-2" class="result-box"></div>
                    </div>

                    <!-- Section 4: Bike -->
                    <div class="card">
                        <h2>🚲 YouBike <button class="btn-add" onclick="openStationModal('bike')">+</button></h2>
                        <div id="bike-list-2" class="station-list"></div>
                        <div id="bike-result-2" class="result-box"></div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: CUSTOM -->
            <div id="tab-custom" class="dashboard-tab-content">
                <div class="dashboard-grid">
                    <!-- Section 1: Itinerary & Query -->
                    <div class="card full-width" style="border-color: #a855f7;">
                        <h2>想去哪? (自訂導航)</h2>

                        <!-- Controls -->
                        <div
                            style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:15px;">

                            <label style="color:#aaa; font-size:0.9em;">請輸入目的地 (例如: 台北101、淡水老街)</label>
                            <div style="display:flex; gap:10px;">
                                <input type="text" id="customDestInput" placeholder="輸入地點 或 點選右側選擇..." style="flex:1;">
                                <button onclick="openSourceSelectModal('custom')"
                                    style="white-space:nowrap; width:auto;">📂 選擇站點</button>
                            </div>

                            <!-- Traffic Preferences (Moved Here) -->
                            <div
                                style="display: flex; gap: 15px; flex-wrap: wrap; padding: 5px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                                <!-- SPECIAL OPTIONS -->
                                <label
                                    style="cursor:pointer; display:flex; align-items:center; gap:5px; color:#fbbf24; font-weight:bold;"><input
                                        type="checkbox" id="prefFastest"> ⚡ 最速方案</label>
                                <label
                                    style="cursor:pointer; display:flex; align-items:center; gap:5px; color:#f472b6;"><input
                                        type="checkbox" id="prefHSR"> 🚄 高鐵</label>

                                <!-- STANDARD OPTIONS -->
                                <label style="cursor:pointer; display:flex; align-items:center; gap:5px;"><input
                                        type="checkbox" id="prefTrain"> 🚆 火車</label>
                                <label style="cursor:pointer; display:flex; align-items:center; gap:5px;"><input
                                        type="checkbox" id="prefMRT"> 🚇 捷運</label>
                                <label style="cursor:pointer; display:flex; align-items:center; gap:5px;"><input
                                        type="checkbox" id="prefBus"> 🚌 公車</label>
                                <label style="cursor:pointer; display:flex; align-items:center; gap:5px;"><input
                                        type="checkbox" id="prefBike"> 🚲 YouBike</label>
                                <label style="cursor:pointer; display:flex; align-items:center; gap:5px;"><input
                                        type="checkbox" id="prefWalk"> 🚶 步行</label>
                                style="cursor:pointer; display:flex; align-items:center; gap:5px; color:#fbbf24;
                                font-weight:bold;"><input type="checkbox" id="prefFastest"> ⚡ 最速方案</label>
                            </div>

                            <button id="sendBtnCustom" onclick="handleCustomRoute()" class="btn-primary"
                                style="background: linear-gradient(135deg, #a855f7, #6366f1);">
                                📍 驗證並規劃路線
                            </button>
                            <div id="custom-status"
                                style="font-size:0.9em; color:#aaa; margin-top:5px; min-height:1.2em;"></div>
                        </div>

                        <div id="itinerary-result-custom" class="result-box" style="padding:15px; min-height:100px;">
                            <span style="color:#666">等待輸入...</span>
                        </div>
                    </div>

                    <!-- Restored Station Blocks (Empty, no favorites) -->
                    <!-- Section 2: Train -->
                    <div class="card">
                        <h2>🚄 火車</h2>
                        <div id="train-list-custom" class="station-list"></div>
                        <div id="train-result-3" class="result-box"></div>
                    </div>

                    <!-- Section 3: MRT -->
                    <div class="card">
                        <h2>捷運</h2>
                        <div id="mrt-list-custom" class="station-list"></div>
                        <div id="mrt-result-3" class="result-box"></div>
                    </div>

                    <!-- Section 3: Bus -->
                    <div class="card">
                        <h2>🚌 公車</h2>
                        <div id="bus-list-custom" class="station-list"></div>
                        <div id="bus-result-3" class="result-box"></div>
                    </div>

                    <!-- Section 4: Bike -->
                    <div class="card">
                        <h2>🚲 YouBike</h2>
                        <div id="bike-list-custom" class="station-list"></div>
                        <div id="bike-result-3" class="result-box"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATION MODAL (Add Stations) -->
        <div id="stationModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle" style="margin:0;">新增站點</h3>
                    <div style="flex-grow: 1; display: flex; gap: 5px; position: relative; margin: 0 15px;">
                        <input type="text" id="modalSearch" oninput="filterStations(this.value)"
                            style="margin: 0; padding:6px;" placeholder="搜尋站點...">
                        <button id="clearSearchBtn" onclick="clearSearch()"
                            style="display:none; position:absolute; right:5px; top:5px; padding:2px 5px;">X</button>
                    </div>
                    <button onclick="openDebugModal('modal')"
                        style="font-size:0.8rem; padding: 4px 8px; margin-right:5px;">Debug Info</button>
                    <button onclick="closeModal('stationModal')"
                        style="border:none; font-size:1.5rem; background:transparent;">×</button>
                </div>
                <div class="modal-body">
                    <div class="modal-sidebar" id="modalSidebar"></div>
                    <div class="modal-main">
                        <div id="loadingIndicator" style="display:none; text-align:center;">AI 搜尋中...</div>
                        <div id="modalGrid" class="station-grid"></div>
                        <div id="modalHelpText" style="margin-top:auto; color:#64748b; font-size:0.8em;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LOCATION SELECT MODAL (For Ambiguous Search Results) -->
        <div id="locationSelectModal" class="modal-overlay">
            <div class="modal-content sm">
                <div class="modal-header">
                    <h3>📍 請選擇正確地點</h3>
                    <button onclick="closeModal('locationSelectModal')">×</button>
                </div>
                <div class="modal-body" style="padding: 10px;">
                    <p style="color:#aaa; font-size:0.9em; margin-bottom:10px;">搜尋到多個結果，請選擇您想去的地方：</p>
                    <div id="locationSelectList"
                        style="display:flex; flex-direction:column; gap:8px; max-height:300px; overflow-y:auto;">
                        <!-- JS populated options -->
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS MODAL -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal-content sm">
                <div class="modal-header">
                    <h3>⚙️ 個人化設定</h3>
                    <div style="display:flex; gap:10px;">
                        <button onclick="openHelpModal()" style="padding:4px 10px; font-size:0.9em;">❓ 說明</button>
                        <button onclick="closeModal('settingsModal')">×</button>
                    </div>
                </div>
                <div class="settings-form">
                    <!-- Tabs -->
                    <div class="tabs" style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #444;">
                        <button id="tabBtnWeekday" class="tab-btn active" onclick="switchSettingsTab('weekday')"
                            style="padding:8px 15px; background:none; border:none; color:var(--text-color); border-bottom:2px solid var(--accent-color);">🏢
                            平日設定</button>
                        <button id="tabBtnHoliday" class="tab-btn" onclick="switchSettingsTab('holiday')"
                            style="padding:8px 15px; background:none; border:none; color:#888;">🏖️ 假日設定</button>
                    </div>

                    <!-- API Key (Common) -->
                    <div class="form-group">
                        <label class="form-label">Google Gemini API Key</label>
                        <input type="password" id="settingApiKey" placeholder="貼上 API Key">
                    </div>

                    <hr style="border:0; border-top:1px solid var(--card-border); margin:20px 0;">

                    <!-- Tab Content: Weekday -->
                    <div id="tabWeekday" class="tab-content">
                        <!-- Work Settings -->
                        <div class="form-group">
                            <label class="form-label">🏢 上班設定</label>
                            <span class="form-sub-label">上班時間</span>
                            <input type="time" id="settingWorkTime">

                            <span class="form-sub-label" style="margin-top:10px;">交通工具組合 (途中)</span>
                            <div class="checkbox-group">
                                <label class="checkbox-label"><input type="checkbox" name="workTrans" value="train">
                                    火車</label>
                                <label class="checkbox-label"><input type="checkbox" name="workTrans" value="mrt">
                                    捷運</label>
                                <label class="checkbox-label"><input type="checkbox" name="workTrans" value="bus">
                                    公車</label>
                                <label class="checkbox-label"><input type="checkbox" name="workTrans" value="bike">
                                    YouBike</label>
                            </div>

                            <!-- Work Last Mile -->
                            <div class="sub-box">
                                <label class="form-label" style="font-size:0.95em;">🏁 最後一哩路 (抵達公司)</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="text" id="settingWorkStation" placeholder="點擊選擇站點..." readonly
                                        onclick="openSourceSelectModal('work')"
                                        style="cursor:pointer; background:#2a2a2a;">
                                </div>
                            </div>
                        </div>

                        <!-- Home Settings -->
                        <div class="form-group">
                            <label class="form-label">🏠 下班設定</label>
                            <span class="form-sub-label">下班時間</span>
                            <input type="time" id="settingHomeTime">

                            <span class="form-sub-label" style="margin-top:10px;">交通工具組合 (途中)</span>
                            <div class="checkbox-group">
                                <label class="checkbox-label"><input type="checkbox" name="homeTrans" value="train">
                                    火車</label>
                                <label class="checkbox-label"><input type="checkbox" name="homeTrans" value="mrt">
                                    捷運</label>
                                <label class="checkbox-label"><input type="checkbox" name="homeTrans" value="bus">
                                    公車</label>
                                <label class="checkbox-label"><input type="checkbox" name="homeTrans" value="bike">
                                    YouBike</label>
                            </div>

                            <!-- Home Last Mile -->
                            <div class="sub-box">
                                <label class="form-label" style="font-size:0.95em;">🏁 最後一哩路 (抵達住家)</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="text" id="settingHomeStation" placeholder="點擊選擇站點..." readonly
                                        onclick="openSourceSelectModal('home')"
                                        style="cursor:pointer; background:#2a2a2a;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Content: Holiday -->
                    <div id="tabHoliday" class="tab-content" style="display:none;">
                        <div class="alert-box"
                            style="background:rgba(255,255,255,0.05); padding:10px; border-radius:4px; margin-bottom:15px; font-size:0.9em; color:#aaa;">
                            ℹ️ 系統會自動根據台灣國定假日(ROC Calendar)判斷是否為假日。如果是假日，將優先使用此處設定。
                        </div>

                        <!-- Old Home Settings -->
                        <div class="form-group">
                            <label class="form-label">🏡 抵達老家</label>
                            <!-- Old Home Last Mile -->
                            <div class="sub-box">
                                <label class="form-label" style="font-size:0.95em;">🏁 最後一哩路</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="text" id="settingOldHomeStation" placeholder="點擊選擇站點..." readonly
                                        onclick="openSourceSelectModal('holiday_oldHome')"
                                        style="cursor:pointer; background:#2a2a2a;">
                                </div>
                            </div>
                        </div>

                        <!-- Holiday Home Settings -->
                        <div class="form-group">
                            <label class="form-label">🏠 抵達住家 (回程)</label>
                            <!-- Holiday Home Last Mile -->
                            <div class="sub-box">
                                <label class="form-label" style="font-size:0.95em;">🏁 最後一哩路</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="text" id="settingHolidayHomeStation" placeholder="點擊選擇站點..." readonly
                                        onclick="openSourceSelectModal('holiday_home')"
                                        style="cursor:pointer; background:#2a2a2a;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn-primary" onclick="saveSettings()">儲存設定</button>
                </div>
            </div>
        </div>

        <!-- Source Selection Modal (New) -->
        <div id="sourceSelectModal" class="modal-overlay-top">
            <div class="modal-content sm" style="max-width: 400px; text-align: center;">
                <div class="modal-header">
                    <h3>選擇站點</h3>
                    <button onclick="closeModal('sourceSelectModal')">×</button>
                </div>
                <div class="modal-body" style="padding: 20px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button class="btn-menu" onclick="openStationModal('train', 'select')">🚆 火車</button>
                        <button class="btn-menu" onclick="openStationModal('mrt', 'select')">🚇 捷運</button>
                        <button class="btn-menu" onclick="openStationModal('bus', 'select')">🚌 公車</button>
                        <button class="btn-menu" onclick="openStationModal('bike', 'select')">🚲 YouBike</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- HELP MODAL -->
        <div id="helpModal" class="modal-overlay-top">
            <div class="modal-content sm">
                <div class="modal-header">
                    <h3>❓ 使用說明</h3>
                    <button onclick="closeModal('helpModal')">×</button>
                </div>
                <div class="modal-body" style="overflow-y: auto;">
                    <div class="help-content">
                        <h2>Assistant</h2>
                        <p>一個基於 Google Gemini API 的個人助理網頁，整合了交通資訊查詢與智慧路線規劃功能。</p>

                        <h3>🛡️ 關於「最後一哩路」</h3>
                        <p>為了保障您的查詢安全，並避免行蹤遭有心人士窺伺，本系統僅針對「最後一哩路」的交通站點（如車站）進行導航規劃。您無需輸入真實地址，即可享有便利且安全的服務。</p>

                        <h3>✨ 功能特色</h3>
                        <ul>
                            <li><strong>日常通勤</strong>：一鍵查詢上班/下班的最佳路線 (支援火車、捷運、公車、YouBike)。</li>
                            <li><strong>回老家規劃</strong>：針對假日返鄉需求，提供專屬的路線規劃功能。</li>
                            <li><strong>自定義導航</strong>：想去哪就去哪，輸入目的地即可自動規劃。</li>
                            <li><strong>智慧判斷</strong>：系統會根據時間自動切換「上班」或「下班」模式。</li>
                            <li><strong>隱私安全</strong>：API Key 與設定僅儲存在您的瀏覽器，不會上傳伺服器。</li>
                        </ul>

                        <h3>🚀 如何使用</h3>
                        <ol>
                            <li><strong>初始設定</strong>：
                                <ul>
                                    <li>首次使用請點擊「前往設定」或設定圖示 ⚙️。</li>
                                    <li>輸入 <a href="https://aistudio.google.com/" target="_blank"
                                            style="color:var(--accent-color)">Google AI Studio</a> 申請的 API Key。</li>
                                    <li>設定您的上班/住家/老家地點與交通偏好。</li>
                                </ul>
                            </li>
                            <li><strong>新增站點</strong>：
                                <ul>
                                    <li>點擊各交通工具區塊的「+」按鈕。</li>
                                    <li>支援火車、捷運、公車、YouBike 站點搜尋與加入。</li>
                                </ul>
                            </li>
                            <li><strong>開始查詢</strong>：
                                <ul>
                                    <li>點擊主畫面的查詢按鈕 (如「📍 規劃路線」)。</li>
                                    <li>允許瀏覽器定位權限，AI 將會結合您的位置與設定提供最佳建議。</li>
                                </ul>
                            </li>
                        </ol>

                        <h3>❓ 常見問題</h3>
                        <ul>
                            <li><strong>Q: 按鈕顯示「請先設定 API Key」？</strong>
                                <p style="margin-top:5px;">請進入設定頁面貼上有效的 Gemini API Key 並儲存。</p>
                            </li>
                            <li><strong>Q: 為什麼 GPS 沒反應？</strong>
                                <p style="margin-top:5px;">請確認瀏覽器已允許網頁存取位置權限。</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- Footer with Creator Info -->
                <div class="modal-footer"
                    style="padding: 15px; border-top: 1px solid #333; display: flex; justify-content: center; align-items: center; gap: 15px;">
                    <div style="font-size: 0.9em; color: #888; text-align: left; line-height: 1.4;">
                        <div>Created by <strong>Gemini 3 Pro</strong> (99.9%)</div>
                        <div style="font-size: 0.9em; color: #666;">Idea & Review by <strong>Odise</strong></div>
                    </div>
                    <a href="https://github.com/OdiseTseng/ai_assistant" target="_blank"
                        style="text-decoration: none; display: flex; align-items: center;">
                        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
                            alt="GitHub" style="width: 24px; height: 24px; background: white; border-radius: 50%;">
                    </a>
                </div>
            </div>
        </div>
        </li>
        </ul>
    </div>
    </div>
    </div>
    </div>

    <!-- INIT PROMPT MODAL -->
    <!-- INIT PROMPT MODAL -->
    <div id="initPromptModal" class="modal-overlay" onclick="if(event.target===this) closeModal('initPromptModal')">
        <div class="modal-content"
            style="max-width: 450px; display: flex; flex-direction: column; padding: 0; overflow: hidden; background: #1e293b;">

            <!-- 1. 主標題區塊 (Header): Title Left, Close Right -->
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; background: #1e293b; border-bottom: 1px solid #334155;">
                <h2 style="font-size: 1.5em; margin: 0; color: #fff; font-weight: 600;">歡迎使用</h2>
                <button class="close-btn" onclick="closeModal('initPromptModal')"
                    style="position: static; font-size: 1.5em; line-height: 1; margin: 0; color: #94a3b8;">&times;</button>
            </div>

            <!-- 2. 主文區塊 (Body): Top-Down Stacking -->
            <div class="modal-body"
                style="padding: 30px 40px; text-align: center; background: #0f172a; flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <p style="font-size: 1.1em; color: #e2e8f0; margin-bottom: 20px; line-height: 1.6;">
                    系統檢測到您尚未設定<br>
                    <strong style="color: var(--accent-color);">API Key</strong> 或 <strong
                        style="color: var(--accent-color);">上下班地點</strong>
                </p>
                <p style="color: #94a3b8; font-size: 0.95em; line-height: 1.6; margin: 0;">
                    為了讓 AI 助理能正常為您規劃路線，<br>建議您現在前往設定頁面完成配置。
                </p>
            </div>

            <!-- 3. 按鈕區塊 (Footer): At the bottom -->
            <div class="modal-footer"
                style="padding: 20px 40px 30px; background: #0f172a; display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-primary" onclick="closeModal('initPromptModal'); openSettings();"
                    style="width: 100%; padding: 12px; font-size: 1.1em; display: flex; justify-content: center; align-items: center; gap: 8px; border-radius: 6px;">
                    前往設定 <span style="font-size: 1.1em;">⚙️</span>
                </button>
                <button class="btn-secondary" onclick="closeModal('initPromptModal')"
                    style="width: 100%; padding: 10px; background: transparent; border: 1px solid #334155; color: #64748b; font-size: 0.95em; border-radius: 6px;">
                    稍後再說
                </button>
            </div>

        </div>
    </div>

    <!-- Debug Console Modal -->
    <div id="debugModal" class="modal-overlay">
        <div class="modal-content debug-modal"
            style="width: 90vw; height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h2>🛠️ 後台 Debug Console</h2>
                <span class="close-btn" onclick="closeModal('debugModal')">&times;</span>
            </div>
            <div class="modal-body"
                style="flex: 1; display: flex; flex-direction: column; overflow: hidden; gap: 10px;">
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <label style="color: var(--accent-color); font-weight: bold;">🌐 其他 API 查詢與回覆 (Non-AI)</label>
                    <textarea id="debugOtherApiLog" readonly
                        style="flex: 1; width: 100%; background: #111; color: #aaa; padding: 10px; font-family: monospace; border: 1px solid #333; resize: none; margin-bottom: 10px;"></textarea>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <label id="debugPromptLabel" style="color: var(--accent-color); font-weight: bold;">📤 Sent
                        Prompt</label>
                    <textarea id="debugPrompt" readonly
                        style="flex: 1; width: 100%; background: #111; color: #0f0; padding: 10px; font-family: monospace; border: 1px solid #333; resize: none;"></textarea>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <label style="color: var(--accent-color); font-weight: bold;">📥 Received Response</label>
                    <textarea id="debugResponse"
                        style="flex: 1; width: 100%; background: #111; color: #0df; padding: 10px; font-family: monospace; border: 1px solid #333; resize: none;"></textarea>
                    <button onclick="simulateRendering()" class="btn-primary"
                        style="margin-top:10px; background: var(--success-color);">▶ 模擬渲染 (Simulate
                        Rendering)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="version.js"></script>
    <script src="station_data.js"></script>
    <script src="api_service.js"></script>
    <script src="script.js"></script>
</body>

</html>